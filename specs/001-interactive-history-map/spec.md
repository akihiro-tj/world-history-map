# Feature Specification: インタラクティブ世界史地図

**Feature Branch**: `001-interactive-history-map`
**Created**: 2025-11-29
**Status**: Draft
**Input**: User description: "世界史の各年代における領土の地図をインタラクティブに見られるWebアプリケーション"

## 背景と目的

### 背景

世界史の学習では「縦のつながり」（時代を超えた因果関係）と「横のつながり」（同時代の地域間関係）を意識しながら学ぶことが重要である。しかし、現状では以下の課題がある：

- 教科書は時代区分でセクションが区切られており、縦のつながりを意識しづらい
- 横のつながりを意識するためには資料集などの副教材を参照する必要があるが、教科書を読みながら該当箇所を探すのが面倒

### 目的

[historical-basemaps](https://github.com/aourednik/historical-basemaps) のデータを活用し、世界史の各年代における領土変遷をインタラクティブに可視化することで、縦と横のつながりを直感的に理解できるWebアプリケーションを提供する。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 地図の閲覧と操作 (Priority: P1)

ユーザーとして、世界地図上で特定の年代の領土分布を確認し、ズームやパンで詳細を見たい。これにより、ある時代の世界全体の勢力図を一目で把握できる。

**Why this priority**: 地図表示はアプリケーションの根幹機能であり、これがなければ他の全ての機能が成立しない。

**Independent Test**: 地図を開き、ズーム・パン操作ができ、領土の境界が表示されることを確認できれば、基本的な価値を提供できる。

**Acceptance Scenarios**:

1. **Given** アプリケーションを開いた状態, **When** 初期画面が表示される, **Then** 1650年（デフォルト年代）の世界地図と領土境界が表示される
2. **Given** 地図が表示されている状態, **When** ピンチイン/アウトまたはマウスホイール操作をする, **Then** 地図がズームイン/アウトされる
3. **Given** 地図が表示されている状態, **When** ドラッグ操作をする, **Then** 地図がパン（移動）される
4. **Given** 地図が表示されている状態, **When** 領土を確認する, **Then** 各領土が色分けと境界線で視覚的に区別できる
5. **Given** 地図が表示されている状態, **When** 主要な領土を確認する, **Then** 領土名がラベルとして地図上に表示されている

---

### User Story 2 - 年代の選択と変更 (Priority: P2)

ユーザーとして、表示する年代を自由に選択・変更し、異なる時代の領土分布を比較したい。これにより、領土の変遷（縦のつながり）を把握できる。

**Why this priority**: 年代選択は「縦のつながり」を理解するための核心機能であり、地図表示の次に重要。

**Independent Test**: 年代セレクターで異なる年を選択し、地図上の領土表示が変化することを確認できれば、時代比較の価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 地図が表示されている状態, **When** 年代選択UIを確認する, **Then** 年代ボタンが横並びで表示され、選択中の年代が中央に強調表示されている
2. **Given** 年代一覧が表示されている状態, **When** 特定の年代を選択する, **Then** 地図がその年代の領土分布に更新される
3. **Given** 年代が変更された状態, **When** 地図を確認する, **Then** 現在選択中の年代が明確に表示されている

---

### User Story 3 - 領土情報の表示 (Priority: P3)

ユーザーとして、地図上の領土を選択してその歴史的な説明を読みたい。説明内のリンクから別の年代にジャンプすることで、関連する時代への理解を深めたい。

**Why this priority**: 領土の詳細情報は学習を深化させるが、まず地図と年代選択が機能していることが前提となる。

**Independent Test**: 領土をクリックして説明パネルが表示され、説明内の年代リンクをクリックすると地図がその年代に遷移することを確認できれば、学習体験の価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 地図が表示されている状態, **When** 特定の領土をクリック/タップする, **Then** その領土の歴史的説明が表示される
2. **Given** 領土の説明が表示されている状態, **When** 説明内容を確認する, **Then** 領土名、時代背景、主要な出来事が含まれており、AIによる自動生成である旨が明記されている
3. **Given** 説明内に年代リンクがある状態, **When** 年代リンクをクリックする, **Then** 地図がその年代の表示に切り替わる
4. **Given** 領土の説明が表示されている状態, **When** 説明パネルを閉じる操作をする, **Then** 説明パネルが閉じて地図のみの表示に戻る

---

### User Story 4 - ライセンス・免責事項の確認 (Priority: P4)

ユーザーとして、利用されているデータのライセンス情報と、データの正確性に関する免責事項を確認したい。

**Why this priority**: 法的要件を満たし、ユーザーがデータの性質を理解するために必要だが、ユーザー体験の本質ではない。

**Independent Test**: アプリケーション内でライセンス情報と免責事項にアクセスでき、内容が明記されていることを確認できる。

**Acceptance Scenarios**:

1. **Given** アプリケーションを使用している状態, **When** ライセンス・免責事項へのリンクをクリックする, **Then** データソースのライセンス情報と免責事項が表示される
2. **Given** ライセンス・免責事項が表示されている状態, **When** 内容を確認する, **Then** historical-basemapsへの帰属が明記されている
3. **Given** ライセンス・免責事項が表示されている状態, **When** 免責事項を確認する, **Then** 以下の内容が含まれている：
   - 地図データは作業中のプロジェクトであり、学術利用前に他のソースとの照合を推奨すること
   - 歴史的な領土境界には概念的な限界があること（領土の定義は時代・文化により異なる）
   - 係争地域が存在する可能性があること

---

### Edge Cases

- 選択した年代のデータが存在しない場合、どのように表示されるか？ → データが存在しない旨のメッセージを表示し、最も近い年代を提案する
- 領土に説明データがない場合、どのように表示されるか？ → 「この領土の詳細情報は準備中です」と表示する
- 非常に古い年代（紀元前など）でデータが不完全な場合 → 利用可能なデータの範囲で表示し、データの制限について注記する
- ネットワーク接続が不安定な場合 → 読み込み中の表示を出し、タイムアウト時はエラーメッセージを表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは世界地図上に領土境界を表示できなければならない
- **FR-002**: システムは主要な領土の名称をラベルとして地図上に表示しなければならない
- **FR-003**: システムはズーム操作（拡大・縮小）をサポートしなければならない
- **FR-004**: システムはパン操作（地図の移動）をサポートしなければならない
- **FR-005**: システムは年代選択のUIを提供しなければならない
- **FR-006**: システムは選択された年代に応じて領土表示を更新しなければならない
- **FR-007**: システムは領土クリック時にその領土の歴史的説明を表示しなければならない
- **FR-008**: 領土の説明内の年代参照は、クリック可能なリンクとして機能しなければならない
- **FR-009**: システムはデータソースのライセンス情報を表示できなければならない
- **FR-010**: システムはデータの正確性に関する免責事項を表示できなければならない
- **FR-011**: システムはhistorical-basemapsのデータを領土表示に利用しなければならない

### Key Entities

- **領土 (Territory)**: 特定の年代における政治的・地理的な支配領域。名称、境界（地理座標）、所属する時代範囲を持つ
- **年代 (Year/Era)**: 地図データが存在する特定の時点。historical-basemapsで提供される年代に対応
- **領土説明 (Territory Description)**: 領土の歴史的背景、主要な出来事、関連する年代へのリンクを含むテキスト情報。AIによる自動生成コンテンツを使用し、その旨を明記する

### Assumptions

- historical-basemapsのデータ形式（GeoJSON等）をそのまま、または変換して利用可能
- 領土説明のコンテンツは段階的に追加可能な設計とする（初期リリースでは一部のみ）
- 対応ブラウザはモダンブラウザ（Chrome、Firefox、Safari、Edgeの最新2バージョン）
- モバイルデバイスでのタッチ操作もサポートする
- 対応言語は日本語のみ（国際化対応は将来の拡張として検討）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは3秒以内に初期地図表示を確認できる
- **SC-002**: ズーム・パン操作が滑らかに動作する（操作から表示更新まで100ms以内の体感）
- **SC-003**: 年代を変更してから地図が更新されるまで2秒以内
- **SC-004**: 領土をクリックしてから説明が表示されるまで1秒以内
- **SC-005**: historical-basemapsで提供されている全ての年代のデータにアクセスできる
- **SC-006**: ユーザーは5回以内の操作で任意の年代・任意の領土の情報にアクセスできる

## Clarifications

### Session 2025-11-29

- Q: 初期表示のデフォルト年代は？ → A: 1650年（ウェストファリア条約直後、近代国家システムの始まり。データソースで1648年がなく1650年が最も近い）
- Q: 領土説明コンテンツのデータソースは？ → A: AIで自動生成し、生成である旨を明記する
- Q: 年代選択UIの形式は？ → A: 年代ボタンを横並びにし、選択中の年代を中央に表示・強調する
- Q: 対応言語は？ → A: 日本語のみ
- Q: 領土の視覚的区別方法は？ → A: 色分け＋境界線の両方
